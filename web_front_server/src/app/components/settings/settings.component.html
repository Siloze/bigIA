<!-- Ajoute Font Awesome dans ton index.html -->
<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512..." crossorigin="anonymous" referrerpolicy="no-referrer" /> -->

<div class="settings-container">
    <!-- Pre-Prompt -->
    <div class="prompt-section">
      <div class="section-header">
        <div class="section-title">
          <i class="fa-solid fa-pen-nib"></i>
          <span>Pre-Prompt</span>
        </div>
      </div>
      <textarea [(ngModel)]="settingService.pre_prompt" id="pre-prompt" placeholder="Écris ici ton pre-prompt..."></textarea>
    </div>
    <div class="extra-settings-trigger" (click)="toggleExtraSettings()">
      <span class="trigger-text">Extras</span>
      <label class="expand-toggle">
        <span class="chevron" [class.open]="openExtraSettings">&#9662;</span>
      </label>
    </div>

    <div *ngIf="openExtraSettings && doError" class="error-panel">
      <div class="error-content">
        <i class="fa-solid fa-triangle-exclamation"></i>
        <p>Une erreur est survenue lors du chargement des paramètres.</p>
        <button class="refresh-btn" (click)="refreshSettings()">
          <i class="fa-solid fa-rotate-right fa-sm refresh-logo"></i> Rafraîchir
        </button>
      </div>
    </div>

    <!-- Extra settings -->
    <div @collapseVertical *ngIf="openExtraSettings && !doError" class="extra-settings">
      <!-- RAG -->
      <div class="prompt-section">
        <div class="section-header">
          <div class="section-title">
            <i class="fa-solid fa-database"></i>
            <span>RAG</span>
          </div>
          <div>
              <!-- <label class="switch">
              <input type="checkbox" [checked]="isRagPromptActivate()" (change)="toggleRag()">
              <span class="slider"></span>
              </label> -->
              <button (click)="reload_rag()" class="refresh-rag-btn" (click)="refreshSettings()">
              <i class="fa-solid fa-rotate-right fa-sm refresh-rag-logo"></i>
              </button>

              <label class="expand-toggle" (click)="toggleRag()">
                <span class="chevron" [class.open]="isRagPromptActivate()">&#9662;</span>
              </label>
              <button *ngIf="dirtySections.rag" class="save-btn" (click)="saveSetting('rag')">
                <i class="fa-solid fa-floppy-disk fa-lg"></i>
              </button>
          </div>
        </div>
        <div @collapseVertical *ngIf="isRagPromptActivate()" class="prompt-options">
          <label for="rag-infos">Nombre d'infos à récupérer</label>
          <input type="number" min="0" [(ngModel)]="settingService.rag_count" id="rag-infos" (change)="markDirty('rag')">
          <div @collapseVertical *ngIf="settingService.rag_count">
            <label for="rag-prompt">Prompt RAG</label>
            <textarea [(ngModel)]="settingService.rag_prompt" (input)="markDirty('rag')" id="rag-prompt" placeholder="Écris ici ton prompt pour le RAG..."></textarea>
          </div>
          <label for="rag-path">Chemin des datas du RAG</label>
          <textarea class="rag-path-input" [(ngModel)]="settingService.rag_data_path" (input)="markDirty('rag')" id="rag-path" placeholder="Chemin pour les datas du RAG (/projectDir/data/ by default)"></textarea>
        </div>
      </div>
    
      <!-- Mémoire directe -->
      <div class="prompt-section">
        <div class="section-header">
          <div class="section-title">
            <i class="fa-solid fa-history"></i>
            <span>Mémoire directe</span>
          </div>
          <div>
              <!-- <label class="switch">
              <input type="checkbox" [checked]="directMemoryEnabled()" (change)="toggleDirectMemory()">
              <span class="slider"></span>
              </label> -->
              <label class="expand-toggle" (click)="toggleDirectMemory()">
                <span class="chevron" [class.open]="directMemoryEnabled()">&#9662;</span>
              </label>
              <button *ngIf="dirtySections.directMemory" class="save-btn" (click)="saveSetting('directMemory')">
                  <i class="fa-solid fa-floppy-disk fa-lg"></i>
              </button>
          </div>
        </div>
        <div @collapseVertical *ngIf="directMemoryEnabled()" class="prompt-options">
          <label for="direct-memory-messages">Nombre de derniers messages</label>
          <input type="number" min="0" [(ngModel)]="settingService.direct_memory_count" id="direct-memory-messages" (change)="markDirty('directMemory')">
          <div @collapseVertical *ngIf="settingService.direct_memory_count">
            <label for="direct-memory-prompt">Prompt Mémoire Directe</label>
            <textarea [(ngModel)]="settingService.direct_memory_prompt" (input)="markDirty('directMemory')" id="direct-memory-prompt" placeholder="Écris ici ton prompt pour la mémoire directe..."></textarea>
          </div>
        </div>
      </div>
    
      <!-- Mémoire sémantique -->
      <div class="prompt-section">
        <div class="section-header">
          <div class="section-title">
            <i class="fa-solid fa-brain"></i>
            <span>Mémoire sémantique</span>
          </div>
          <div>
              <!-- <label class="switch">
              <input type="checkbox" [checked]="semanticMemoryEnabled()" (change)="toggleSemanticMemory()">
              <span class="slider"></span>
              </label> -->
              <label class="expand-toggle" (click)="toggleSemanticMemory()">
                <span class="chevron" [class.open]="semanticMemoryEnabled()">&#9662;</span>
              </label>
              <button *ngIf="dirtySections.semanticMemory" class="save-btn" (click)="saveSetting('semanticMemory')">
                  <i class="fa-solid fa-floppy-disk fa-lg"></i>
              </button>
          </div>
        </div>
        <div @collapseVertical *ngIf="semanticMemoryEnabled()" class="prompt-options">
          <label for="semantic-memory-messages">Nombre de messages similaires</label>
          <input type="number" min="0" [(ngModel)]="settingService.semantic_memory_count" id="semantic-memory-messages" (change)="markDirty('semanticMemory')">
          <div @collapseVertical *ngIf="settingService.semantic_memory_count">
            <label for="semantic-memory-prompt">Prompt Mémoire Sémantique</label>
            <textarea [(ngModel)]="settingService.semantic_memory_prompt" id="semantic-memory-prompt" placeholder="Écris ici ton prompt pour la mémoire sémantique..." (input)="markDirty('semanticMemory')"></textarea>
          </div>
        </div>
      </div>
    </div>
  </div>